# Клиент/Сериализация

В этой библиотеке объекты JSON-RPC request/notification/response называются **"заголовками"**, и они сериализуются отдельно от объектов params/result/error. Можно влиять на то, как сериализуются полезные данные, не заботясь о заголовках.

**Замечание:** здесь и сериализация, и **де**сериализация называются просто "сериализацией" для простоты.

## Сериализация заголовков

В спецификации JSON-RPC есть некоторые странности, которые не очень хорошо сочетаются со строгой статической типизацией и автоматическими конвертерами вроде  System.Text.Json:

* Поле `id` в Request может содержать число, строку или null и должно быть возвращено в ответе в изначальном виде 
* Если поля `id` нет, то это Notification
* Поля Response `result` и `error` являются взаимоисключающими и обозначают успех или ошибку
* Поле `params` может содержать или объект, или массив
* Весь запрос может быть массивом - тогда это Batch

Для адаптации этих правил к типам C# потребовались разные ухищрения, и они не должны повлиять на сериализацию пользовательских данных.
Кроме того, формат заголовков (например snake_case) фиксирован, поэтому не нужно его настраивать.

Все это обрабатывается в `HeadersJsonSerializerOptions` и разных конвертерах. В пользовательском коде они не нужны.

## Сериализация params/result/error

С другой стороны, может понадобиться продвинутая сериализация JSON (kebab-case, дополнительные конвертеры, обработка DateTime и тп) для пользовательских данных.

Для этого есть `DataJsonSerializerOptions` в настройках.

Можено использовать одно из готовых значений в классе `JsonRpcSerializerOptions`, или создать собственный объект `JsonSerializerOptions`.
